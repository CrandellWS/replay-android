general:
    artifacts:
         - "~/build_output.zip" # Save APK's, Lint Results, and Test Results

machine:
    environment:
        ANDROID_HOME: /usr/local/android-sdk-linux


dependencies:
    cache_directories:
        - ~/.android
        - ~/android
    pre:
       - (source scripts/replay-envsetup.sh && ensureDependenciesAndCreateAVD)
    override:
       - (echo "overriding `gradlew dependencies`")

test:
    pre:
        - $ANDROID_HOME/tools/emulator -avd testAVD -no-skin -no-audio -no-window:
           background: true
        - (./gradlew assembleDebug):
            timeout: 360
        - (./gradlew assembleDebugTest):
            timeout: 360
        - (source scripts/replay-envsetup.sh && waitAVD)
    override:
        - (echo "Override")
        - (./gradlew :replay-android:connectedAndroidTest)
    post:
        - zip -r ~/build_output.zip app/build/outputs/

deployment:
    sonatype:
        branch: [master]
        owner: Originate
        commands:
            - (echo "Beginning publish task to Sonatype/MavenCentral")
            - (source scripts/replay-envsetup.sh && sonatypePublish):
                timeout: 360
